#! /bin/bash

for owl in `find programs -name '*.owl'`; do
    flags=`cat $(dirname "$owl")/FLAGS`
    out=`mktemp`
    err=`mktemp`
    ./owl $flags $owl 1> $out 2> $err
    if [ $? == 0 ]; then
        mv $out ${owl}.out
        rm -f ${owl}.err
    else
        mv $err ${owl}.err
        rm -f ${owl}.out
    fi
done
if git status -s programs | grep '\.owl$'; then
    echo 'TESTS FAILED'
else
    echo 'TESTS PASSED'
fi
