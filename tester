#! /bin/bash

for owl in `find programs -name '*.owl'`; do
    flags=`cat $(dirname "$owl")/FLAGS`
    out=`tempfile`
    err=`tempfile`
    ./owl $flags $owl 1> $out 2> $err
    if [ $? == 0 ]; then
        diff -ZBu $owl.out $out
        if [ $? != 0 ]; then
            exit 1
        fi
    else
        diff -ZBu $owl.err $err
        if [ $? != 0 ]; then
            exit 1
        fi
    fi
done
echo "ALL TESTS PASSED"
